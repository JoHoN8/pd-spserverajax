!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("jquery"),require("pd-sputil")):"function"==typeof define&&define.amd?define(["jquery","pd-sputil"],t):"object"==typeof exports?exports.pdspserverajax=t(require("jquery"),require("pd-sputil")):e.pdspserverajax=t(e.$,e.pdsputil)}(this,function(e,t){return function(e){function t(n){if(r[n])return r[n].exports;var a=r[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,r){"use strict";function n(e){return e.endPoint="_api/contextinfo",S(e),x.ajax({url:e.configuredUrl,method:"POST",headers:{Accept:"application/json; odata=minimalmetadata"}}).then(function(t){return e.endPoint=null,e.configuredUrl=null,t})}function a(e){return x.ajax({url:e,type:"GET",headers:{Accept:"application/json; odata=minimalmetadata"}})}function i(e){return e.listGUID||e.listTitle?(L(e),a(e.listUrl).then(function(t){var r=e.allResults||[];return e.allResults=r.concat(t.value),t["odata.nextLink"]?(e.listUrl=t["odata.nextLink"],i(e)):e.allResults})):x.Deferred().reject("must pass listGUID or listTitle to ajaxGetAllListResults")}function o(e){var t=[],r=0;for(e.totalItems=e.getUrls.length,e.totalPerTrip=50,e.allResults=[],e.numberToStartAt=0;e.numberToStartAt<e.totalItems;e.numberToStartAt++){var n=e.getUrls[e.numberToStartAt];if(t.push(n),++r===e.totalPerTrip){e.numberToStartAt++;break}}return E({origin:e.origin,url:e.url},t).then(function(t){return e.allResults=e.allResults.concat(t),e.numberToStartAt<e.totalItems?o(e):e.allResults})}function s(e){return w(e),a(e.listUrl)}function l(e){var t=e.currentResults||[],r={startrow:0,rowlimit:500,TrimDuplicates:!1,selectproperties:"'"+e.properties.join(",")+"'"};return r.startrow=e.startrow?e.startrow:0,r.sourceId=e.sourceId?"'"+e.sourceId+"'":"'b09a7990-05ea-4af9-81ef-edfab16c4e31'",e.endPoint="_api/search/query",r.querytext="'"+e.query+"'",S(e),x.ajax({url:e.configuredUrl,type:"GET",headers:{Accept:"application/json; odata=minimalmetadata"},data:r}).then(function(n){var a=n.PrimaryQueryResult.RelevantResults;return t=t.concat(a.Table.Rows),e.currentResults=t,a.TotalRows>r.startrow+a.RowCount?(e.startrow=r.startrow+a.RowCount,l(e)):e.currentResults})}function u(e){return n(e).then(function(t){return e.endPoint="_api/web",S(e),e.configuredUrl+="/ensureUser('"+Object(b.encodeAccountName)(e.email)+"')",x.ajax({url:e.configuredUrl,type:"POST",contentType:T,headers:{Accept:v,"X-RequestDigest":t.FormDigestValue}})})}function c(e){return e.endPoint="_api/web/siteusers",S(e),e.configuredUrl+="?$filter=LoginName eq '"+Object(b.encodeAccountName)(e.email)+"'",a(e.configuredUrl)}function p(e){return n(e).then(function(t){var r={query:{__metadata:{type:"SP.CamlQuery"},ViewXml:e.caml}},n={Accept:"application/json; odata=minimalmetadata","Content-Type":"application/json; odata=verbose","X-RequestDigest":t.FormDigestValue};return w(e),e.listUrl+="/getitems",x.ajax({url:e.listUrl,type:"POST",data:JSON.stringify(r),headers:n})})}function d(e){var t=Object(b.encodeAccountName)(e.email);return e.endPoint="_api/web",S(e),e.permsLink=e.configuredUrl+"/getusereffectivepermissions(@user)?@user='"+t+"'",M(e)}function f(e){var t=Object(b.encodeAccountName)(e.email);return w(e),e.permsLink=e.listUrl+"/getusereffectivepermissions(@user)?@user='"+t+"'",M(e)}function m(e){return e.endPoint="/_api/web",S(e),e.configuredUrl+="/GetUserbyId("+e.userId+")/Groups",a(e.configuredUrl).then(function(e){var t=[];return e.value.forEach(function(e){t.push(e.Title)}),t})}function h(e){return O(e)}function U(e){return e.headerData={"X-HTTP-Method":"MERGE","If-Match":e.etag||"*"},O(e)}function j(e){return e.headerData={"X-HTTP-Method":"DELETE","If-Match":e.etag||"*"},_(e)}function g(e){return e.urlModifier="/recycle",_(e)}function P(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=null;return e.email?(e.endPoint="_api/sp.userprofiles.peoplemanager",t="/getpropertiesfor(@v)?@v='"+Object(b.encodeAccountName)(e.email)+"'&"):(e.endPoint="_api/SP.UserProfiles.PeopleManager/GetMyProperties",t="?"),S(e),e.configuredUrl+=t+"$select=UserProfileProperties",a(e.configuredUrl).then(function(e){return!0===e["odata.null"]?[]:e.UserProfileProperties})}function y(e){return e.allData||(e.allData=!1),w(e),e.listUrl+="/fields?$filter=Hidden eq "+e.allData+" and ReadOnlyField eq "+e.allData,a(e.listUrl)}Object.defineProperty(t,"__esModule",{value:!0}),t.ajaxGetContext=n,t.ajaxGetData=a,t.ajaxGetAllListResults=i,t.ajaxGetBatchMetered=o,t.ajaxGetListInfo=s,t.ajaxPeopleSearch=l,t.ajaxEnsureUser=u,t.ajaxGetSiteUserInfoByEmail=c,t.ajaxGetItemsByCaml=p,t.ajaxGetUserSitePermissions=d,t.ajaxGetUserListPermissions=f,t.ajaxGetCurrentUserGroups=m,t.ajaxCreateItem=h,t.ajaxUpdateItem=U,t.ajaxDeleteItem=j,t.ajaxRecycleItem=g,t.userProfileData=P,t.getListColumns=y;var x=r(1),b=(r.n(x),r(2)),v=(r.n(b),"application/json;odata=minimalmetadata"),T="application/json;odata=verbose",D=function(e){return"SP.Data."+e.charAt(0).toUpperCase()+e.slice(1)+"ListItem"},I=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],R=function(){for(var e="",t=0;t<32;t++){var r=Math.floor(16*Math.random());switch(t){case 8:e+="-";break;case 12:r=4,e+="-";break;case 16:r=3&r|8,e+="-";break;case 20:e+="-"}e+=I[r]}return e},S=function(e){return e.configuredUrl=e.origin?e.origin:Object(b.getURLOrigin)(),e.url&&(e.configuredUrl+=e.url),e.endPoint&&(e.configuredUrl+="/"+e.endPoint),e},w=function(e){if(e.url&&!e.listUrl)return e.endPoint="_api/web",S(e),e.listGUID?e.listUrl=e.configuredUrl+="/lists(guid'"+e.listGUID+"')":e.listTitle&&(e.listUrl=e.configuredUrl+="/lists/getbytitle('"+e.listTitle+"')"),e},A=function(e){var t=e.itemId||"";if(!e.listItemUrl)return w(e),e.listItemUrl=e.listUrl+="/items("+t+")",e},G=function(e){var t;return e.listName?(t=D(e.listName),x.Deferred().resolve(t)):s(e).then(function(e){return e.ListItemEntityTypeFullName})},O=function(e){return e.headerData||(e.headerData={}),G(e).then(function(t){return e.item=x.extend({__metadata:{type:t}},e.infoToServer),n(e)}).then(function(t){return e.headerData["X-RequestDigest"]=t.FormDigestValue,e.headerData.Accept="application/json; odata=minimalmetadata",A(e),x.ajax({url:e.listItemUrl,type:"POST",contentType:"application/json;odata=verbose",data:JSON.stringify(e.item),headers:e.headerData})})},_=function(e){return e.headerData||(e.headerData={}),n(e).then(function(t){return e.headerData["X-RequestDigest"]=t.FormDigestValue,e.headerData.Accept="application/json; odata=minimalmetadata",A(e),e.urlModifier&&(e.listItemUrl+=e.urlModifier),x.ajax({url:e.listItemUrl,type:"POST",contentType:"application/json;odata=verbose",headers:e.headerData})})},q=function(e){var t=new SP.BasePermissions;t.initPropertiesFromJson(e);var r=[];for(var n in SP.PermissionKind.prototype)if(SP.PermissionKind.hasOwnProperty(n)){var a=SP.PermissionKind.parse(n);t.has(a)&&r.push(n)}return r},L=function(e){e.listUrl||(e.endPoint||(e.endPoint="_api/web"),w(e),e.listUrl+="/items?",e.select&&(e.listUrl+="$select="+e.select+"&"),e.top&&(e.listUrl+="$top="+e.top+"&"),e.expand&&(e.listUrl+="$expand="+e.expand+"&"),e.filter&&(e.listUrl+="$filter="+e.filter+"&"),e.orderBy&&(e.listUrl+="$orderby="+e.orderBy+"&"),/\$$/.test(e.listUrl)&&e.listUrl.slice(0,-1))},M=function(e){return a(e.permsLink).then(function(e){return q(e)})},E=function(e,t){var r,a,i=R(),o=[];return t.forEach(function(e){o.push("--batch_"+i),o.push("Content-Type: application/http"),o.push("Content-Transfer-Encoding: binary"),o.push(""),o.push("GET "+e+" HTTP/1.1"),o.push("Accept: application/json;odata=minimalmetadata"),o.push("")}),o.push("--batch_"+i+"--"),r=o.join("\r\n"),n(e).then(function(t){return e.endPoint="_api/$batch",S(e),a={"X-RequestDigest":t.FormDigestValue,"Content-Type":'multipart/mixed; boundary="batch_'+i+'"'},x.ajax({url:e.configuredUrl,type:"POST",data:r,headers:a}).then(function(e){for(var t=[],r=e.split("\n"),n=0;n<r.length;n++)if("{"===r[n].charAt(0))try{var a=JSON.parse(r[n]);t.push(a)}catch(e){}return t})})}},function(t,r){t.exports=e},function(e,r){e.exports=t}])});